// Sample product data (small images use placeholders). In production replace with optimized responsive images and real sources.
const PRODUCTS = [
  {id:1, title:'Handmade Mug', price:349, img:'https://s-media-cache-ak0.pinimg.com/originals/ff/6c/96/ff6c96fa230affe5c5ed148429dc44fc.jpg'},
  {id:2, title:'Canvas Tote Bag', price:499, img:'https://tse4.mm.bing.net/th/id/OIP.weBmnpkkmFhyPdsrTkK6qwHaHx?cb=thfc1&rs=1&pid=ImgDetMain&o=7&rm=3'},
  {id:3, title:'Wireless Earbuds', price:1499, img:'https://m.media-amazon.com/images/I/71-TQ1oSm+L._AC_SL1500_.jpg'},
  {id:4, title:'Plant Pot', price:299, img:'https://i5.walmartimages.com/asr/0c60bdc2-69f9-4030-8ccd-26243f3f1f88.e8365f1fc69844eceb6f20a7af3caa74.jpeg'},
  {id:5, title:'Scented Candle', price:249, img:'https://tse2.mm.bing.net/th/id/OIP.K-NCNplEn6gbRSI28ThPiAHaE8?cb=thfc1&rs=1&pid=ImgDetMain&o=7&rm=3'},
  {id:6, title:'Leather Wallet', price:899, img:'https://i.etsystatic.com/50478446/r/il/a837b4/5961824917/il_600x600.5961824917_kqd6.jpg'},
  {id:7, title:'Bluetooth Speaker', price:1799, img:'https://www.pngmart.com/files/7/Bluetooth-Speaker-PNG-Image.png'},
  {id:8, title:'Travel Backpack', price:2999, img:'https://people.com/thmb/Ywx-CLV6Tx7t7JOpTudoZ72lxNQ=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/peo-timbuk2-authority-laptop-backpack-deluxe-cralph-001.jpg-e3c67529787c49139b2850914b414d90.jpg'},
  {id:9, title:'Running Shoes', price:2199, img:'https://images.pexels.com/photos/163535/run-fitness-workout-train-163535.jpeg?cs=srgb&dl=pexels-pixabay-163535.jpg&fm=jpg'},
  {id:10, title:'Smart Watch', price:2499, img:'https://m.media-amazon.com/images/I/61ZjlBOp+rL.jpg'},
  {id:11, title:'Sunglasses', price:799, img:'https://picfiles.alphacoders.com/288/thumb-1920-288489.jpg'},
  {id:12, title:'Desk Lamp', price:999, img:'https://i5.walmartimages.com/asr/06fe3c4d-b145-4ecc-9f23-ac53b992f311.29d089a03a8748e8945e961b06ceab65.jpeg?odnHeight=612&odnWidth=612&odnBg=FFFFFF'},
  {id:13, title:'Notebook', price:199, img:'https://images.pexels.com/photos/616849/pexels-photo-616849.jpeg?cs=srgb&dl=pexels-lum3n-44775-616849.jpg&fm=jpg'},
  {id:14, title:'Water Bottle', price:349, img:'https://i5.walmartimages.com/seo/Thermoflask-Double-Wall-Vacuum-Insulated-Stainless-Steel-Water-Bottle-2-Pack-Midnight-Stone_1cf8d78d-5a3e-4c91-8e1d-68d64aa81617.5a726f0990af1a03955b21f18dc24cac.jpeg'},
  {id:15, title:'Wireless Charger', price:1299, img:'https://i5.walmartimages.com/asr/356a1dc2-9f90-406c-b811-ea5cebdb9ffa_1.16913f4f29fd6567906fe07289be855e.jpeg'}
];

// Utilities
const byId=id=>document.getElementById(id);
const format=(n)=>n.toFixed(0);

// Cart stored in localStorage
const CART_KEY='mini_cart_v1';
function loadCart(){try{return JSON.parse(localStorage.getItem(CART_KEY))||{}}catch(e){return{}}}
function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c))}

let cart=loadCart();

// Render products
function renderProducts(){const container=byId('products');container.innerHTML='';PRODUCTS.forEach(p=>{
  const card=document.createElement('article');card.className='card';card.setAttribute('role','listitem');
  // use lazy loading + width descriptor for responsive behaviour
  const img=document.createElement('img');img.loading='lazy';img.alt=p.title;img.src=p.img+'?w=800';
  img.decoding='async';
  card.appendChild(img);
  const body=document.createElement('div');body.className='card-body';
  const t=document.createElement('h3');t.className='title';t.textContent=p.title;body.appendChild(t);
  const desc=document.createElement('div');desc.className='product-meta';desc.innerHTML=`<div class="product-desc">Fast Delivery</div><div class="price">₹${format(p.price)}</div>`;
  body.appendChild(desc);
  const controls=document.createElement('div');controls.style.marginTop='0.6rem';
  const btn=document.createElement('button');btn.className='btn';btn.textContent='Add to cart';btn.addEventListener('click',()=>addToCart(p.id));
  controls.appendChild(btn);body.appendChild(controls);
  card.appendChild(body);container.appendChild(card);
})}

function addToCart(id){cart[ id ] = (cart[id]||0)+1;saveCart(cart);updateCartUI()}
function removeFromCart(id){if(cart[id]){delete cart[id];saveCart(cart);updateCartUI()}}
function changeQty(id,qty){if(qty<=0)delete cart[id];else cart[id]=qty;saveCart(cart);updateCartUI()}

// Cart UI
function updateCartUI(){const count=Object.values(cart).reduce((s,q)=>s+q,0);byId('cartCount').textContent=count;const items=byId('cartItems');items.innerHTML='';let total=0;for(const id of Object.keys(cart)){const p=PRODUCTS.find(x=>x.id==id);if(!p)continue;const q=cart[id];total+=p.price*q;const row=document.createElement('div');row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center';row.style.padding='.35rem 0';row.innerHTML=`<div><strong>${p.title}</strong><div style="color:#6b7a81;font-size:.9rem">₹${p.price} x ${q}</div></div>`;
  const actions=document.createElement('div');actions.className='qty';
  const minus=document.createElement('button');minus.textContent='-';minus.addEventListener('click',()=>changeQty(id,cart[id]-1));
  const plus=document.createElement('button');plus.textContent='+';plus.addEventListener('click',()=>changeQty(id,cart[id]+1));
  const rem=document.createElement('button');rem.textContent='Remove';rem.style.marginLeft='8px';rem.addEventListener('click',()=>removeFromCart(id));
  actions.appendChild(minus);actions.appendChild(plus);actions.appendChild(rem);
  row.appendChild(actions);items.appendChild(row);
}
byId('cartTotal').textContent=total;}


// Checkout mock
byId('checkoutBtn').addEventListener('click',()=>{
  alert('Checkout is demo-only. Your cart total is: ₹'+byId('cartTotal').textContent);
});

// Init
renderProducts();updateCartUI();

// Basic feature-detection polyfill suggestion: add forEach on NodeList in older browsers
if(!NodeList.prototype.forEach){NodeList.prototype.forEach=Array.prototype.forEach}